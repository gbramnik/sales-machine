<!-- Powered by BMAD™ Core -->

# Story 5.4: Onboarding Wizard (Frontend)

## Status
Draft

## Story
**As a** user,
**I want** a friendly visual wizard,
**so that** I can complete setup in <2 hours without feeling overwhelmed.

## Dependencies
- **Story 5.1** (Onboarding Wizard Backend) MUST be completed - Backend API endpoints and session management
- **Story 1.1** (Project Infrastructure Setup) MUST be completed - React setup, Supabase Auth, routing
- **Story 1.11** (Settings Management API) MUST be completed - Settings storage for domain verification
- **Story 1.7** (Meeting Booking Integration) SHOULD be completed - Calendar OAuth flow reference

## Acceptance Criteria
1. Multi-step wizard UI with progress indicator (Step 1 of 5)
2. Conversational copy: "Let's get your AI Sales Rep configured! This will take about 10 minutes."
3. Industry selection: Visual cards with icons (not dropdown) - click to select
4. ICP preview: "Based on your industry, we recommend targeting: [job titles]. Sound good?" (editable)
5. Domain verification: Automated DNS check with green checkmarks, red X with "Fix this" instructions
6. Calendar connect: OAuth popup, success confirmation with preview of available time slots
7. Final summary: "You're all set! Your AI Sales Rep will start prospecting for [X] meetings/month targeting [industry]."
8. Single "Activate My AI Sales Rep" button (per UI Design Goals)

## Tasks / Subtasks

- [ ] **Task 1: Create onboarding wizard page structure** (AC: 1, 2)
  - [ ] Create page: `apps/web/src/pages/OnboardingPage.tsx`
  - [ ] Create wizard layout component: `apps/web/src/components/templates/OnboardingWizard.tsx`
    - Progress indicator: Step X of 5 (top of page)
    - Progress bar: Visual indicator showing completion percentage
    - Step content area: Renders current step component
    - Navigation buttons: "Back" (if not step 1), "Next" / "Continue" (if not last step), "Activate" (last step)
  - [ ] Implement step state management:
    - State: `const [currentStep, setCurrentStep] = useState<number>(1)`
    - Total steps: 5 (goal, industry, icp, domain, calendar)
    - Step validation: Disable "Next" if current step incomplete
  - [ ] Add route: `apps/web/src/App.tsx`
    - Add route: `<Route path="/onboarding" element={<OnboardingPage />} />`
    - Redirect logic: If user already completed onboarding, redirect to dashboard
  - [ ] Add conversational header:
    - Text: "Let's get your AI Sales Rep configured! This will take about 10 minutes."
    - Friendly tone, encouraging language
    - Display on all steps (consistent header)

- [ ] **Task 2: Implement Step 1 - Goal Selection** (AC: 1, 2)
  - [ ] Create component: `apps/web/src/components/organisms/OnboardingStepGoal.tsx`
  - [ ] Display goal options as visual cards:
    - Option 1: "5-10 meetings/month" - Card with icon and description
    - Option 2: "10-20 meetings/month" - Card with icon and description
    - Option 3: "20-30 meetings/month" - Card with icon and description
  - [ ] Use shadcn/ui Card component:
    - `import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'`
    - Hover effect: Border color change, shadow elevation
    - Selected state: Primary color border, checkmark icon
  - [ ] Implement selection logic:
    - Click card → Selects goal, stores in state
    - Visual feedback: Selected card highlighted
    - Disable "Next" until goal selected
  - [ ] Call backend API:
    - On selection: `POST /api/onboarding/step/goal_selection` with `{ goal_meetings_per_month: '5-10' | '10-20' | '20-30' }`
    - Update session: Store goal in onboarding session
  - [ ] Add helpful description:
    - "How many qualified meetings do you want per month? This helps us configure your campaign volume."

- [ ] **Task 3: Implement Step 2 - Industry Selection** (AC: 3)
  - [ ] Create component: `apps/web/src/components/organisms/OnboardingStepIndustry.tsx`
  - [ ] Fetch industries from backend:
    - Call API: `GET /api/onboarding/industries` (or use static list)
    - Industries: SaaS, Consulting, Agencies, Financial Services, Healthcare, Legal, Real Estate, Manufacturing, Retail, Education, Technology Services, HR, Accounting, Insurance, Construction, Logistics, Energy, Media, Hospitality, Non-profit
  - [ ] Display as visual cards grid:
    - Grid layout: 3-4 columns on desktop, 2 columns on tablet, 1 column on mobile
    - Each card: Industry name, icon (emoji or SVG), brief description
    - Use shadcn/ui Card component with hover effects
  - [ ] Implement selection:
    - Click card → Selects industry, stores in state
    - Visual feedback: Selected card highlighted with checkmark
    - Search/filter: Optional search bar to filter industries
  - [ ] Call backend API:
    - On selection: `POST /api/onboarding/step/industry` with `{ industry: string }`
    - Trigger ICP auto-suggestion: Backend suggests ICP config based on industry
  - [ ] Add helpful description:
    - "What industry are you targeting? We'll customize your campaign settings based on your selection."

- [ ] **Task 4: Implement Step 3 - ICP Preview & Configuration** (AC: 4)
  - [ ] Create component: `apps/web/src/components/organisms/OnboardingStepICP.tsx`
  - [ ] Fetch auto-suggested ICP from backend:
    - Call API: `GET /api/onboarding/status` → Get `icp_config` from session
    - Display: "Based on your industry, we recommend targeting:"
  - [ ] Display ICP suggestions:
    - **Job Titles:** List of suggested job titles (editable chips)
      - Display as removable chips: `import { Badge } from '@/components/ui/badge'`
      - Add new job title: Input field + "Add" button
      - Remove job title: X button on chip
    - **Company Sizes:** Checkboxes for company size ranges
      - Options: "1-10", "11-50", "51-200", "201-500", "500+"
      - Pre-selected based on industry suggestion
    - **Locations:** Multi-select dropdown or chips
      - Pre-populated with suggested locations
      - Add/remove locations
  - [ ] Implement editable preview:
    - "Sound good?" message with friendly tone
    - Edit button: "Customize" → Expands to show full editing interface
    - Save button: "Looks good!" → Saves ICP config
  - [ ] Call backend API:
    - On save: `POST /api/onboarding/step/icp` with `{ icp_config: { job_titles, company_sizes, locations } }`
    - Update session: Store ICP config in onboarding session
  - [ ] Add helpful description:
    - "We've suggested some ideal customer profiles based on your industry. Feel free to customize!"

- [ ] **Task 5: Implement Step 4 - Domain Verification** (AC: 5)
  - [ ] Create component: `apps/web/src/components/organisms/OnboardingStepDomain.tsx`
  - [ ] Display domain input field:
    - Input: "Enter your sending domain (e.g., sales.yourcompany.com)"
    - Validation: Check domain format (regex)
    - Help text: "This is the domain you'll send emails from"
  - [ ] Implement automated DNS check:
    - On domain entry: Call API: `POST /api/onboarding/step/domain` with `{ domain: string }`
    - Backend checks DNS records: SPF, DKIM, DMARC
    - Show loading state: "Checking DNS records..." with spinner
  - [ ] Display verification results:
    - **SPF Record:** Green checkmark ✅ if valid, red X ❌ if missing
    - **DKIM Record:** Green checkmark ✅ if valid, red X ❌ if missing
    - **DMARC Record:** Green checkmark ✅ if valid, red X ❌ if missing
    - Use shadcn/ui Alert component for status messages
  - [ ] Show fix instructions for failed checks:
    - If SPF missing: "Add this SPF record to your DNS: [instructions]"
    - If DKIM missing: "Generate DKIM keys and add to DNS: [instructions]"
    - If DMARC missing: "Add DMARC policy: [instructions]"
    - Link to detailed guide: "View full setup guide" (opens in new tab)
  - [ ] Allow retry:
    - "Re-check DNS" button: Calls domain verification API again
    - Show success message: "All DNS records verified! ✅"
  - [ ] Skip option (optional):
    - "I'll set this up later" checkbox
    - Allows proceeding without domain verification (with warning)

- [ ] **Task 6: Implement Step 5 - Calendar Connection** (AC: 6)
  - [ ] Create component: `apps/web/src/components/organisms/OnboardingStepCalendar.tsx`
  - [ ] Display calendar provider selection:
    - Option 1: "Google Calendar" - Card with Google logo
    - Option 2: "Microsoft Outlook" - Card with Outlook logo
    - Click card → Initiates OAuth flow
  - [ ] Implement OAuth popup:
    - On selection: Open OAuth URL in popup window
    - OAuth URL: `GET /api/onboarding/calendar/oauth?provider=google|outlook`
    - Popup dimensions: 600x700px, centered
    - Handle OAuth callback: Listen for popup message with access token
  - [ ] Show OAuth flow status:
    - "Connecting..." → "Authorizing..." → "Connected! ✅"
    - Loading spinner during OAuth flow
  - [ ] Display success confirmation:
    - "Calendar connected successfully!"
    - Preview: Show available time slots (if available from calendar API)
    - Calendar email: Display connected calendar email address
  - [ ] Call backend API:
    - On OAuth callback: `POST /api/onboarding/step/calendar` with `{ provider, access_token, refresh_token }`
    - Backend stores tokens (encrypted) in onboarding session
  - [ ] Add helpful description:
    - "Connect your calendar so we can automatically book meetings when prospects are qualified."

- [ ] **Task 7: Implement Final Summary & Activation** (AC: 7, 8)
  - [ ] Create component: `apps/web/src/components/organisms/OnboardingStepSummary.tsx`
  - [ ] Display summary of configuration:
    - **Goal:** "X meetings/month"
    - **Industry:** "[Selected Industry]"
    - **ICP:** "Targeting [job titles] at [company sizes] in [locations]"
    - **Domain:** "sending from [domain]" (if verified) or "Domain setup pending"
    - **Calendar:** "Connected to [provider]" (if connected) or "Calendar connection pending"
  - [ ] Show friendly completion message:
    - "You're all set! Your AI Sales Rep will start prospecting for [X] meetings/month targeting [industry]."
    - Celebration animation (optional): Confetti or success icon
  - [ ] Implement pre-flight checklist:
    - Check all prerequisites: Domain verified, Calendar connected, ICP configured
    - Show checklist: ✅ Domain verified, ✅ Calendar connected, ✅ ICP configured
    - If any missing: Show warning: "Complete these steps to activate your AI Sales Rep"
  - [ ] Add single activation button:
    - Button text: "Activate My AI Sales Rep" (per UI Design Goals)
    - Style: Large, primary, prominent
    - Disabled if prerequisites not met
  - [ ] Implement activation:
    - On click: Call API: `POST /api/onboarding/complete`
    - Backend: Applies auto-configuration, creates first campaign, marks onboarding complete
    - Show loading: "Activating your AI Sales Rep..." with spinner
    - On success: Redirect to dashboard: `navigate('/dashboard')`
    - Show success toast: "Welcome! Your AI Sales Rep is now active."

- [ ] **Task 8: Implement progress indicator and navigation** (AC: 1)
  - [ ] Create progress bar component: `apps/web/src/components/molecules/OnboardingProgressBar.tsx`
    - Visual progress bar: Shows completion percentage (0-100%)
    - Step indicators: "Step 1 of 5", "Step 2 of 5", etc.
    - Completed steps: Green checkmarks
    - Current step: Highlighted with primary color
    - Future steps: Grayed out
  - [ ] Implement navigation buttons:
    - "Back" button: Only visible if `currentStep > 1`
      - On click: `setCurrentStep(currentStep - 1)`
      - Preserves form data (doesn't lose user input)
    - "Next" / "Continue" button: Visible if `currentStep < 5`
      - Disabled if current step incomplete
      - On click: Validates step, saves data, advances to next step
    - "Activate" button: Only visible on step 5 (summary)
  - [ ] Add step validation:
    - Each step component exports `validateStep()` function
    - Returns: `{ isValid: boolean, errors?: string[] }`
    - Wizard calls validation before allowing "Next"

- [ ] **Task 9: Implement session persistence** (AC: 1, 2)
  - [ ] Create hook: `apps/web/src/hooks/useOnboardingSession.ts`
    - Fetch session: `GET /api/onboarding/status`
    - Create session: `POST /api/onboarding/start` (if no session exists)
    - Save step data: `POST /api/onboarding/step/{step_id}` (on each step completion)
  - [ ] Implement auto-resume:
    - On page load: Check if onboarding session exists
    - If exists: Resume at `current_step` from session
    - If completed: Redirect to dashboard
  - [ ] Save progress on each step:
    - On "Next" click: Save step data to backend
    - On step change: Update `current_step` in session
    - Prevents data loss on page refresh
  - [ ] Handle session expiration:
    - If session expired: Show message, offer to start over
    - Create new session: `POST /api/onboarding/start`

- [ ] **Task 10: Add mobile responsive design** (AC: 1, 2, 3, 4, 5, 6)
  - [ ] Optimize wizard for mobile:
    - Single column layout on mobile (no sidebars)
    - Full-width cards for industry/goal selection
    - Stacked form fields (not side-by-side)
    - Larger touch targets (min 44x44px)
    - Bottom navigation bar: Fixed at bottom with "Back" / "Next" buttons
  - [ ] Test on mobile viewport:
    - Use Tailwind responsive classes: `md:grid-cols-3 grid-cols-1`
    - Test touch interactions: Tap to select, swipe gestures (optional)
    - Ensure text is readable (min 16px font size)
  - [ ] Optimize OAuth popup for mobile:
    - Full-screen modal instead of popup (mobile browsers block popups)
    - Redirect flow instead of popup (if popup fails)

- [ ] **Task 11: Add loading states and error handling** (AC: All)
  - [ ] Implement loading states:
    - Step transitions: Show skeleton loader while loading step data
    - API calls: Disable buttons, show spinner during requests
    - Domain verification: Show "Checking..." state
    - OAuth flow: Show "Connecting..." state
  - [ ] Implement error handling:
    - API errors: Show user-friendly error messages
    - Network errors: "Connection failed. Please try again."
    - Validation errors: Show inline error messages below form fields
    - Retry logic: "Retry" button for failed API calls
  - [ ] Add error boundaries:
    - Wrap wizard in React Error Boundary
    - Show fallback UI: "Something went wrong. Please refresh the page."

- [ ] **Task 12: Generate TypeScript types** (AC: All)
  - [ ] Create types: `apps/web/src/types/onboarding.ts`
    - `OnboardingStep` type: `'goal_selection' | 'industry' | 'icp' | 'domain' | 'calendar' | 'complete'`
    - `OnboardingSession` interface (matches API response)
    - `ICPConfig` interface: `{ job_titles: string[], company_sizes: string[], locations: string[] }`
    - `DomainVerificationResult` interface
  - [ ] Import from shared package if available:
    - Check `packages/shared/src/types/` for existing types
    - Use shared types if they match requirements

- [ ] **Task 13: Write unit tests** (AC: All)
  - [ ] Create test: `apps/web/tests/unit/components/OnboardingStepGoal.test.tsx`
    - Test render: Displays goal options
    - Test selection: Selects goal, calls API
    - Test validation: Disables Next if no goal selected
  - [ ] Create test: `apps/web/tests/unit/components/OnboardingStepIndustry.test.tsx`
    - Test render: Displays industry cards
    - Test selection: Selects industry, triggers ICP suggestion
  - [ ] Create test: `apps/web/tests/unit/components/OnboardingStepDomain.test.tsx`
    - Test DNS check: Calls verification API
    - Test results: Displays checkmarks/X for each record
    - Test retry: Re-checks DNS on retry click
  - [ ] Create test: `apps/web/tests/unit/hooks/useOnboardingSession.test.ts`
    - Test session fetch: Loads existing session
    - Test step save: Saves step data to backend
    - Test auto-resume: Resumes at correct step

## Dev Notes

### Architecture Context

**Onboarding Wizard Frontend:**
- Multi-step wizard UI for user onboarding
- 5 steps: Goal selection, Industry selection, ICP configuration, Domain verification, Calendar connection
- Conversational, friendly tone throughout
- Visual card-based selection (not dropdowns)
- Progress indicator and step validation
- Session persistence for resume capability

**Integration with Story 5.1:**
- Uses backend API endpoints from Story 5.1
- Endpoints: `POST /onboarding/start`, `POST /onboarding/step/{step_id}`, `GET /onboarding/status`, `POST /onboarding/complete`
- Session management handled by backend
- Auto-configuration applied on completion

**Integration with Story 1.11:**
- Domain verification uses SettingsService for DNS checking
- Domain verification logic exists in backend (Story 5.1)

**Integration with Story 1.7:**
- Calendar OAuth flow references Story 1.7 implementation
- OAuth URLs and token handling follow same pattern

**Previous Story Insights:**
From Story 5.1: Onboarding backend API exists. `onboarding_sessions` table stores session data. `industry_icp_mappings` table provides auto-suggestions. Domain verification checks SPF, DKIM, DMARC records. Calendar OAuth flow implemented for Google/Outlook.

From Story 1.1: React setup, Supabase Auth, routing infrastructure exists. Can use Supabase Auth for user session management.

**UI/UX Considerations:**
- Conversational, friendly copy throughout
- Visual card selection (not dropdowns) for better UX
- Progress indicator shows completion status
- Mobile-first responsive design
- Loading states for all async operations
- Error handling with user-friendly messages
- Single "Activate" button (per UI Design Goals)

**Design System:**
- Use Tailwind CSS + shadcn/ui components
- Follow existing design patterns from Story 5.2 (Dashboard)
- Consistent color scheme and typography
- Accessible: ARIA labels, keyboard navigation

### Testing

**Testing Framework:** Vitest for unit tests, React Testing Library for component tests, Playwright for E2E tests (optional)

**Test Organization:**
- Component tests: `apps/web/tests/unit/components/`
- Hook tests: `apps/web/tests/unit/hooks/`
- Page tests: `apps/web/tests/unit/pages/`

**Test Requirements:**
1. Test wizard navigation: Steps advance, back button works, progress updates
2. Test goal selection: Options render, selection works, API called
3. Test industry selection: Cards render, selection works, ICP suggested
4. Test ICP configuration: Suggestions display, editing works, save succeeds
5. Test domain verification: DNS check runs, results display, retry works
6. Test calendar connection: OAuth popup opens, callback handled, success shown
7. Test final summary: Summary displays, activation works, redirects to dashboard
8. Test session persistence: Resume at correct step, data preserved
9. Test mobile responsive: Layout adapts, touch interactions work
10. Test error handling: Errors display, retry works, validation prevents advance

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-13 | 1.0 | Initial story creation for Epic 5: Zero-Config Onboarding & Dashboard UX | Sarah (Product Owner) |

## Dev Agent Record

### Agent Model Used
TBD

### Completion Notes
- Story created as part of Epic 5: Zero-Config Onboarding & Dashboard UX
- Implements frontend wizard UI for user onboarding
- Provides conversational, friendly experience for setup
- Integrates with Story 5.1 backend API
- Supports mobile responsive design
- Single "Activate My AI Sales Rep" button per UI Design Goals

