<!-- Powered by BMADâ„¢ Core -->

# Story 2.2: VIP Mode for High-Value Accounts

## Status
Draft

## Story
**As a** user,
**I want** to manually approve ALL AI messages for critical prospects,
**so that** I never risk my reputation on important relationships.

## Dependencies
- **Story 2.1** (AI Confidence Scoring System) MUST be completed - AI review queue infrastructure and confidence scoring
- **Story 1.6** (Basic AI Conversational Agent) MUST be completed - AI agent workflow
- **Story 1.2** (LinkedIn Profile Scraping) MUST be completed - Job title data for VIP detection
- **Story 1.3** (AI-Powered Contextual Enrichment) MUST be completed - Enrichment data for VIP context

## Acceptance Criteria
1. VIP flag exists in `prospects` table (boolean: `is_vip`, default false) - **Already exists in schema**
2. VIP criteria detection: Automatically flag if C-level title (CEO, CTO, CMO, CFO, COO, President, Founder) OR user manually marks account
3. VIP override rule: ALL AI-generated messages for VIP accounts require human approval regardless of confidence score (per FR13)
4. Dedicated VIP review queue (filtered view of `ai_review_queue` with `is_vip = true`) with priority notifications
5. VIP message template: More formal tone, shorter, no aggressive CTA (templates with `is_vip_template = true`)
6. Analytics: Track VIP conversion rate vs. non-VIP to validate manual review value

## Tasks / Subtasks

- [ ] **Task 1: Implement VIP detection logic** (AC: 2)
  - [ ] Create service: `apps/api/src/services/VIPDetectionService.ts`
  - [ ] Implement `detectVIPFromJobTitle(jobTitle: string | null): boolean`:
    - C-level keywords: `['ceo', 'cto', 'cmo', 'cfo', 'coo', 'president', 'founder', 'founder & ceo', 'co-founder']`
    - Case-insensitive matching: `jobTitle.toLowerCase().includes(keyword)`
    - Return: `true` if matches any C-level keyword, `false` otherwise
  - [ ] Implement `markAsVIP(prospectId: string, userId: string, reason: string, autoDetected: boolean = false)`:
    - Update: `UPDATE prospects SET is_vip = TRUE, vip_reason = $reason WHERE id = $prospectId AND user_id = $userId`
    - Log to audit_log: `INSERT INTO audit_log (user_id, event_type, entity_type, entity_id, new_values) VALUES ($userId, 'prospect_marked_vip', 'prospect', $prospectId, { reason, auto_detected: $autoDetected }::jsonb)`
    - Return: `{ success: true, prospect_id: string, is_vip: true, vip_reason: string }`
  - [ ] Implement `unmarkAsVIP(prospectId: string, userId: string)`:
    - Update: `UPDATE prospects SET is_vip = FALSE, vip_reason = NULL WHERE id = $prospectId AND user_id = $userId`
    - Log to audit_log: `INSERT INTO audit_log (user_id, event_type, entity_type, entity_id, new_values) VALUES ($userId, 'prospect_unmarked_vip', 'prospect', $prospectId, {})::jsonb`
    - Return: `{ success: true, prospect_id: string, is_vip: false }`
  - [ ] Add automatic VIP detection in Story 1.2 workflow:
    - Location: `workflows/linkedin-scraper.json`
    - **Option 1:** Add Code node after "Map Profile Data" node (before Supabase insert):
      - Code: `const jobTitle = $json.job_title || ''; const isVIP = VIPDetectionService.detectVIPFromJobTitle(jobTitle); return { json: { ...$json, is_vip: isVIP, vip_reason: isVIP ? 'Auto-detected: C-level title' : null } };`
      - **Note:** Since VIPDetectionService is TypeScript, call API endpoint instead
    - **Option 2:** Add HTTP Request node to call API:
      - URL: `POST {{ $env.API_GATEWAY_URL }}/api/vip/detect`
      - Body: `{ job_title: {{ $json.job_title }} }`
      - Store: `is_vip = response.data.is_vip`, `vip_reason = response.data.reason`
    - **Option 3:** Add Code node with inline detection logic:
      - Code: `const jobTitle = ($json.job_title || '').toLowerCase(); const vipKeywords = ['ceo', 'cto', 'cmo', 'cfo', 'coo', 'president', 'founder', 'co-founder']; const isVIP = vipKeywords.some(keyword => jobTitle.includes(keyword)); return { json: { ...$json, is_vip: isVIP, vip_reason: isVIP ? 'Auto-detected: C-level title' : null } };`
    - Update Supabase "Store Prospect" node to include `is_vip` and `vip_reason` fields:
      - Add mapping: `is_vip: {{ $json.is_vip || false }}`, `vip_reason: {{ $json.vip_reason || null }}`

- [ ] **Task 2: Implement VIP override rule in AI agent workflow** (AC: 3)
  - [ ] **Prerequisite:** Story 2.1 confidence scoring must be complete
  - [ ] Update Story 1.6 workflow: `workflows/ai-conversation-agent.json`
  - [ ] Add VIP check before confidence threshold check:
    - Location: After "Parse Claude Response" node (line 136), before "Qualified & High Confidence?" node (line 169)
    - Add Supabase node: "Check if VIP"
      - Query: `SELECT is_vip, vip_reason FROM prospects WHERE id = {{ $json.prospect_id }}`
      - Store: `is_vip = data.is_vip || false`
    - Add IF node: "Is VIP?"
      - Condition: `is_vip === true`
      - **If true:** Queue for review (bypass confidence threshold check)
        - Insert into `ai_review_queue` using existing "Queue for Review" node pattern:
          - Location: After "Is VIP?" node (true branch), before "Low Confidence?" node
          - Supabase node: "Queue VIP for Review"
          - Fields:
            - `prospect_id`: `={{ $json.prospect_id }}`
            - `user_id`: `={{ $json.user_id }}`
            - `message_type`: `'reply_response'`
            - `proposed_subject`: `={{ $json.qualification_result.proposed_channel === 'email' ? 'Re: Your inquiry' : null }}`
            - `proposed_message`: `={{ $json.qualification_result.reasoning }}`
            - `ai_confidence_score`: `={{ $json.qualification_result.confidence_score }}` (still store for analytics)
            - `ai_reasoning`: `'VIP account - requires manual approval regardless of confidence score'`
            - `status`: `'pending'`
            - `priority`: `10` (highest priority for VIP)
            - `requires_immediate_attention`: `TRUE`
            - `enrichment_data_used`: `={{ JSON.stringify($json.enrichment) }}`
            - `template_id`: `={{ $json.qualification_result.proposed_response_template_id }}`
        - **Note:** No new field `is_vip_review` needed - can filter by `prospects.is_vip` in queries
      - **If false:** Continue with normal confidence threshold check (Story 2.1 logic)
        - Connect to "Low Confidence?" node (existing logic)
  - [ ] Update queue insertion logic:
    - **VIP accounts:** Always queue, regardless of confidence_score
    - **Non-VIP accounts:** Queue only if `confidence_score < user_threshold` (Story 2.1)

- [ ] **Task 3: Add VIP review queue filtering** (AC: 4)
  - [ ] **Prerequisite:** Story 2.1 AIReviewService must exist
  - [ ] Update `AIReviewService` (Story 2.1):
    - Location: `apps/api/src/services/AIReviewService.ts`
    - Add method: `getVIPReviews(userId: string): Promise<ReviewQueueWithProspect[]>`:
      - Use Supabase query with JOIN:
        ```typescript
        const { data, error } = await this.supabase
          .from('ai_review_queue')
          .select(`
            *,
            prospect:prospects!inner(id, full_name, company_name, job_title, is_vip)
          `)
          .eq('user_id', userId)
          .eq('status', 'pending')
          .eq('prospects.is_vip', true)
          .order('priority', { ascending: false })
          .order('created_at', { ascending: true });
        ```
      - Return: Same format as `getPendingReviews()` but filtered to VIP only
    - Add method: `getNonVIPReviews(userId: string): Promise<ReviewQueueWithProspect[]>`:
      - Use Supabase query with JOIN:
        ```typescript
        const { data, error } = await this.supabase
          .from('ai_review_queue')
          .select(`
            *,
            prospect:prospects!inner(id, full_name, company_name, job_title, is_vip)
          `)
          .eq('user_id', userId)
          .eq('status', 'pending')
          .or('prospects.is_vip.eq.false,prospects.is_vip.is.null')
          .order('priority', { ascending: false })
          .order('created_at', { ascending: true });
        ```
      - Return: Non-VIP reviews only
  - [ ] Update review endpoints:
    - Location: `apps/api/src/routes/ai-review-queue.ts`
    - Add query param to `GET /ai-review-queue`: `?filter=vip|non_vip|all` (default: 'all')
      - If `filter=vip`: Call `getVIPReviews(userId)`
      - If `filter=non_vip`: Call `getNonVIPReviews(userId)`
      - If `filter=all` or missing: Call `getPendingReviews(userId)` (existing)
    - Return: `{ success: true, data: reviews, filter: 'vip'|'non_vip'|'all', vip_count: number, non_vip_count: number }`

- [ ] **Task 4: Create VIP message templates** (AC: 5)
  - [ ] **Prerequisite:** Story 1.4 Email Template Library must be complete
  - [ ] Add `is_vip_template` field to `email_templates` table:
    - Check if field exists: `SELECT column_name FROM information_schema.columns WHERE table_name = 'email_templates' AND column_name = 'is_vip_template'`
    - If missing, create migration: `supabase/migrations/YYYYMMDD_add_vip_template_flag.sql`
    - Add: `ALTER TABLE email_templates ADD COLUMN is_vip_template BOOLEAN DEFAULT FALSE`
    - Add index: `CREATE INDEX idx_email_templates_is_vip_template ON email_templates(is_vip_template) WHERE is_vip_template = TRUE`
  - [ ] Create VIP template guidelines:
    - **Tone:** More formal, professional, respectful
    - **Length:** Shorter (2-3 sentences max)
    - **CTA:** Soft, no aggressive calls-to-action (e.g., "Would you be open to a brief conversation?" instead of "Book a call now!")
    - **Personalization:** Use full name, company name, specific talking points
    - **No assumptions:** Avoid making assumptions about their needs
  - [ ] Create seed VIP templates:
    - Location: `supabase/migrations/YYYYMMDD_seed_vip_templates.sql`
    - Templates:
      - **LinkedIn VIP Initial Connection:**
        - `channel = 'linkedin'`, `use_case = 'initial_connection'`, `is_vip_template = TRUE`
        - Subject: N/A (LinkedIn)
        - Body: "Hi {{prospect_name}}, I noticed your role as {{job_title}} at {{company}}. I'd be interested in learning more about your priorities. Would you be open to a brief conversation?"
      - **Email VIP Initial Outreach:**
        - `channel = 'email'`, `use_case = 'initial_outreach'`, `is_vip_template = TRUE`
        - Subject: "Quick question about {{company}}"
        - Body: "Hi {{prospect_name}}, I hope this message finds you well. I'd appreciate a few minutes of your time to discuss {{company_insights}}. Would you be open to a brief conversation?"
      - **LinkedIn VIP Follow-up:**
        - `channel = 'linkedin'`, `use_case = 'follow_up_engaged'`, `is_vip_template = TRUE`
        - Body: "Thank you for your response, {{prospect_name}}. I'd be happy to share more details. Would you prefer a brief call or email exchange?"
  - [ ] Update EmailTemplateService (Story 1.4):
    - Location: `apps/api/src/services/email-template.service.ts`
    - **Note:** Service has `getTemplate()` and `personalizeTemplate()` methods, but may not have `getTemplatesForChannel()`
    - **Option 1:** Add new method `getTemplatesForChannel(channel: string, userId: string, isVIP?: boolean)`:
      - Query: `SELECT * FROM email_templates WHERE channel = $channel AND (user_id = $userId OR is_system_template = TRUE) AND is_active = TRUE AND ($isVIP IS NULL OR ($isVIP = TRUE AND is_vip_template = TRUE) OR ($isVIP = FALSE AND (is_vip_template = FALSE OR is_vip_template IS NULL)))`
      - Return: `EmailTemplate[]`
    - **Option 2:** Update existing `getTemplate()` method to accept VIP filter:
      - Add param: `isVIP?: boolean`
      - Add filter to query if `isVIP` is provided
    - **Option 3:** Create helper method `filterTemplatesByVIP(templates: EmailTemplate[], isVIP: boolean): EmailTemplate[]`:
      - Filter in-memory: `templates.filter(t => isVIP ? t.is_vip_template === true : (t.is_vip_template === false || t.is_vip_template === null))`
  - [ ] Update Story 1.6 workflow to use VIP templates:
    - Location: `workflows/ai-conversation-agent.json`
    - After "Check if VIP" node, pass `is_vip` flag to template selection
    - **Option 1:** Update Supabase node that loads templates:
      - Current: Query `email_templates` table (if exists in workflow)
      - Add condition: `AND (($json.is_vip = TRUE AND is_vip_template = TRUE) OR ($json.is_vip = FALSE AND (is_vip_template = FALSE OR is_vip_template IS NULL)))`
    - **Option 2:** Add Code node to filter templates:
      - After loading templates, filter: `const filtered = templates.filter(t => is_vip ? t.is_vip_template === true : (t.is_vip_template === false || t.is_vip_template === null));`
    - **Option 3:** Call API endpoint for template selection:
      - HTTP Request: `GET {{ $env.API_GATEWAY_URL }}/api/email-templates?channel={{ $json.qualification_result.proposed_channel }}&is_vip={{ $json.is_vip }}`
      - Use response to select template

- [ ] **Task 5: Implement VIP priority notifications** (AC: 4)
  - [ ] **Prerequisite:** Story 2.1 notification system must be complete
  - [ ] Update NotificationService (Story 2.1):
    - Location: `apps/api/src/services/NotificationService.ts`
    - Enhance `notifyPendingReview()` to prioritize VIP reviews:
      - Query pending reviews: Include `p.is_vip` in JOIN
      - Separate VIP and non-VIP counts
      - **Email subject:** `urgent ? "ðŸš¨ URGENT: ${vipCount} VIP + ${nonVIPCount} regular message(s) require review" : "${vipCount} VIP + ${nonVIPCount} regular message(s) awaiting review"`
      - **Email body:** 
        - VIP section first (highlighted): "VIP Accounts (${vipCount}):" with list of VIP prospects
        - Regular section: "Regular Accounts (${nonVIPCount}):" with list of non-VIP prospects
        - VIP reviews marked with ðŸ† icon
      - **Urgent flag:** Set `urgent = true` if `vipCount > 0` OR any review has `confidence_score < 60`
  - [ ] Update N8N notification workflow (Story 2.1):
    - Location: `workflows/review-queue-notifier.json` (create if doesn't exist from Story 2.1)
    - Add Supabase node: "Query Pending Reviews by VIP"
      - Query: `SELECT DISTINCT aq.user_id, COUNT(CASE WHEN p.is_vip = TRUE THEN 1 END) as vip_count, COUNT(CASE WHEN p.is_vip = FALSE OR p.is_vip IS NULL THEN 1 END) as non_vip_count FROM ai_review_queue aq JOIN prospects p ON aq.prospect_id = p.id WHERE aq.status = 'pending' GROUP BY aq.user_id`
    - For each user:
      - Check if `vip_count > 0` OR any review has `requires_immediate_attention = TRUE`
      - Call API: `POST {{ $env.API_GATEWAY_URL }}/api/notifications/pending-reviews`
      - Request body: `{ user_id: {{ $json.user_id }}, count: {{ $json.vip_count + $json.non_vip_count }}, urgent: {{ $json.vip_count > 0 }}, vip_count: {{ $json.vip_count }}, non_vip_count: {{ $json.non_vip_count }} }`
      - Respect notification preferences: Only send if `notification_preferences.email = true`

- [ ] **Task 6: Implement VIP analytics** (AC: 6)
  - [ ] Create service: `apps/api/src/services/VIPAnalyticsService.ts`
  - [ ] Implement `getVIPConversionMetrics(userId: string, startDate: Date, endDate: Date)`:
    - Query VIP prospects: `SELECT COUNT(*) as total_vip FROM prospects WHERE user_id = $userId AND is_vip = TRUE AND created_at BETWEEN $startDate AND $endDate`
    - Query VIP contacted: `SELECT COUNT(*) as contacted_vip FROM prospects WHERE user_id = $userId AND is_vip = TRUE AND status IN ('contacted', 'engaged', 'qualified', 'meeting_booked') AND created_at BETWEEN $startDate AND $endDate`
    - Query VIP qualified: `SELECT COUNT(*) as qualified_vip FROM prospects WHERE user_id = $userId AND is_vip = TRUE AND status IN ('qualified', 'meeting_booked') AND created_at BETWEEN $startDate AND $endDate`
    - Query VIP meetings: `SELECT COUNT(*) as meetings_vip FROM prospects WHERE user_id = $userId AND is_vip = TRUE AND status = 'meeting_booked' AND created_at BETWEEN $startDate AND $endDate`
    - Query non-VIP metrics (same queries with `is_vip = FALSE`):
      - `total_non_vip`, `contacted_non_vip`, `qualified_non_vip`, `meetings_non_vip`
    - Calculate conversion rates:
      - `vip_contact_rate = (contacted_vip / total_vip) * 100`
      - `vip_qualification_rate = (qualified_vip / contacted_vip) * 100` (handle division by zero)
      - `vip_meeting_rate = (meetings_vip / qualified_vip) * 100` (handle division by zero)
      - Same for non-VIP
    - Return: `{ vip: { total, contacted, qualified, meetings, contact_rate, qualification_rate, meeting_rate }, non_vip: { total, contacted, qualified, meetings, contact_rate, qualification_rate, meeting_rate }, comparison: { contact_rate_diff, qualification_rate_diff, meeting_rate_diff } }`
  - [ ] Implement `getVIPReviewMetrics(userId: string, startDate: Date, endDate: Date)`:
    - Query: `SELECT COUNT(*) as total_vip_reviews, COUNT(CASE WHEN status = 'approved' THEN 1 END) as approved_vip, COUNT(CASE WHEN status = 'rejected' THEN 1 END) as rejected_vip FROM ai_review_queue aq JOIN prospects p ON aq.prospect_id = p.id WHERE aq.user_id = $userId AND p.is_vip = TRUE AND aq.created_at BETWEEN $startDate AND $endDate`
    - Calculate:
      - `vip_approval_rate = (approved_vip / total_vip_reviews) * 100`
      - `vip_rejection_rate = (rejected_vip / total_vip_reviews) * 100`
    - Return: `{ total_vip_reviews, approved_vip, rejected_vip, approval_rate, rejection_rate }`
  - [ ] Create API endpoint: `GET /api/metrics/vip`
    - Location: `apps/api/src/routes/metrics.ts` (add to existing)
    - Query params: `?start_date=YYYY-MM-DD&end_date=YYYY-MM-DD` (optional, default: last 30 days)
    - Call: `VIPAnalyticsService.getVIPConversionMetrics(userId, startDate, endDate)`
    - Call: `VIPAnalyticsService.getVIPReviewMetrics(userId, startDate, endDate)`
    - Return: `{ success: true, data: { conversion_metrics: {...}, review_metrics: {...} } }`
    - Add authentication middleware

- [ ] **Task 7: Add manual VIP marking API** (AC: 2)
  - [ ] Create API endpoint: `POST /api/prospects/:id/mark-vip`
    - Location: `apps/api/src/routes/prospects.ts` (add to existing)
    - Request body: `{ reason: string }` (optional, default: "Manually marked as VIP")
    - Validate: Use Zod schema: `z.object({ reason: z.string().min(1).max(500).optional() })`
    - Call: `VIPDetectionService.markAsVIP(prospectId, userId, reason || 'Manually marked as VIP', false)`
    - Return: `{ success: true, data: { prospect_id, is_vip: true, vip_reason } }`
  - [ ] Create API endpoint: `POST /api/prospects/:id/unmark-vip`
    - Location: `apps/api/src/routes/prospects.ts`
    - No request body required
    - Call: `VIPDetectionService.unmarkAsVIP(prospectId, userId)`
    - Return: `{ success: true, data: { prospect_id, is_vip: false } }`
  - [ ] Add authentication middleware to both endpoints

- [ ] **Task 8: Generate TypeScript types** (AC: 1, 2, 3)
  - [ ] Run `supabase gen types typescript` after migration (if needed)
  - [ ] Update `packages/shared/src/types/database.types.ts` with `is_vip_template` field (if migration added)
  - [ ] Create business logic types: `packages/shared/src/types/vip.ts`
    - `VIPDetectionResult = { is_vip: boolean, reason: string, auto_detected: boolean }`
    - `VIPConversionMetrics = { vip: {...}, non_vip: {...}, comparison: {...} }`
    - `VIPReviewMetrics = { total_vip_reviews, approved_vip, rejected_vip, approval_rate, rejection_rate }`
  - [ ] Export types for use in API and frontend

- [ ] **Task 9: Write unit tests** (AC: All)
  - [ ] Create test: `apps/api/tests/unit/services/vip-detection.service.test.ts`
    - Test `detectVIPFromJobTitle()` - Detects C-level titles correctly
    - Test `detectVIPFromJobTitle()` - Returns false for non-C-level titles
    - Test `markAsVIP()` - Marks prospect as VIP and logs to audit_log
    - Test `unmarkAsVIP()` - Unmarks prospect and logs to audit_log
  - [ ] Create test: `apps/api/tests/unit/services/vip-analytics.service.test.ts`
    - Test `getVIPConversionMetrics()` - Returns correct VIP vs non-VIP metrics
    - Test `getVIPReviewMetrics()` - Returns correct review metrics
    - Test division by zero handling
  - [ ] Create test: `apps/api/tests/unit/routes/prospects.test.ts`
    - Test `POST /prospects/:id/mark-vip` - Marks prospect as VIP
    - Test `POST /prospects/:id/unmark-vip` - Unmarks prospect
    - Test validation errors
  - [ ] Create test: `apps/api/tests/unit/routes/ai-review-queue.test.ts`
    - Test `GET /ai-review-queue?filter=vip` - Returns only VIP reviews
    - Test `GET /ai-review-queue?filter=non_vip` - Returns only non-VIP reviews
    - Test `GET /ai-review-queue?filter=all` - Returns all reviews

## Dev Notes

### Architecture Context

**VIP Mode System:**
- VIP flag stored in `prospects.is_vip` (boolean, default false)
- VIP reason stored in `prospects.vip_reason` (text, nullable)
- Automatic detection based on C-level job titles
- Manual marking via API endpoints
- VIP override rule: All AI messages for VIP accounts require approval regardless of confidence score

**Integration with Story 2.1:**
- VIP reviews use same `ai_review_queue` table
- VIP reviews have `priority = 10` (highest) and `requires_immediate_attention = TRUE`
- VIP reviews bypass confidence threshold check (always queued)
- VIP reviews can be filtered via query param `?filter=vip`

**VIP Template System:**
- VIP templates marked with `is_vip_template = TRUE` flag
- VIP templates have formal tone, shorter length, soft CTAs
- Template selection filters by VIP status when generating messages

**Analytics:**
- VIP conversion rates vs non-VIP conversion rates
- VIP review approval/rejection rates
- Comparison metrics to validate manual review value

**Previous Story Insights:**
From Story 2.1: AI review queue infrastructure exists at `apps/api/src/services/AIReviewService.ts`. Review endpoints exist at `apps/api/src/routes/ai-review-queue.ts`. `ai_review_queue` table exists with `priority`, `requires_immediate_attention` fields. NotificationService exists for review notifications.

From Story 1.6: AI agent workflow exists at `workflows/ai-conversation-agent.json`. Workflow calls `/api/ai/qualify` endpoint. Workflow already checks confidence threshold.

From Story 1.2: LinkedIn scraping workflow exists at `workflows/linkedin-scraper.json`. Job title data available in `prospects.job_title` field.

From Story 1.4: EmailTemplateService exists at `apps/api/src/services/email-template.service.ts`. Template library in `email_templates` table.

**Integration Points:**
- Story 2.1 (Confidence Scoring): VIP override bypasses confidence threshold
- Story 1.6 (AI Agent): VIP check added to workflow before confidence check
- Story 1.2 (Scraping): Auto-detection of VIP during scraping
- Story 1.4 (Templates): VIP-specific templates for formal communication

### Testing

**Testing Framework:** Vitest for unit tests, manual testing for N8N workflows

**Test Organization:**
- Service tests: `apps/api/tests/unit/services/vip-detection.service.test.ts`, `apps/api/tests/unit/services/vip-analytics.service.test.ts`
- Route tests: `apps/api/tests/unit/routes/prospects.test.ts`, `apps/api/tests/unit/routes/ai-review-queue.test.ts`
- Integration tests: N8N workflow testing via manual execution

**Test Requirements:**
1. Test VIP detection from job titles (C-level keywords)
2. Test manual VIP marking/unmarking via API
3. Test VIP override rule in AI workflow (always queue VIP messages)
4. Test VIP review queue filtering (filter=vip, filter=non_vip, filter=all)
5. Test VIP template selection (is_vip_template flag)
6. Test VIP priority notifications (VIP reviews highlighted)
7. Test VIP analytics (conversion rates, review metrics)
8. Test automatic VIP detection during scraping

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-11 | 1.0 | Initial story creation for Epic 2: AI Safety & Quality Guardrails | Bob (Scrum Master) |
| 2025-01-11 | 1.1 | Story refinement: Added explicit dependencies, detailed VIP detection logic with multiple implementation options, enhanced workflow integration details, detailed AIReviewService enhancements with Supabase queries, comprehensive VIP template system, improved notification system with VIP prioritization, detailed analytics implementation, improved test scenarios | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
TBD

### Completion Notes
- Story created as part of Epic 2: AI Safety & Quality Guardrails
- Builds upon Story 2.1 AI Confidence Scoring infrastructure
- Implements VIP override rule (FR13) for high-value accounts
- Adds automatic C-level detection and manual VIP marking
- Creates VIP-specific templates and analytics

